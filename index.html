<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur Immobilier Gratuit | Cr√©dit, Rentabilit√© & DPE | Horizon Pierre</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* --- DESIGN SYSTEM (Idem v46) --- */
        :root {
            --primary-dark: #0f172a;
            --primary-blue: #3b82f6;
            --accent-gold: #f59e0b;
            --accent-gold-hover: #d97706;
            --bg-body: #f8fafc;
            --text-main: #334155;
            --text-muted: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --chart-capital: #10b981;
            --chart-interest: #3b82f6;
            --chart-insurance: #6366f1;
            --dpe-a: #009c3d; --dpe-b: #51b94d; --dpe-c: #ccce29;
            --dpe-d: #f3e500; --dpe-e: #fcc900; --dpe-f: #eb8c00; --dpe-g: #d7221f;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0; padding: 0;
            line-height: 1.6;
            display: flex; flex-direction: column; min-height: 100vh;
        }

        /* LAYOUT */
        .top-bar {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            border-bottom: 1px solid #e2e8f0; position: sticky; top: 0; z-index: 1000;
        }
        .header-inner { max-width: 1100px; margin: 0 auto; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .site-wrapper { max-width: 1100px; margin: 40px auto; padding: 0 20px; flex: 1; width: 100%; box-sizing: border-box; }
        
        /* FOOTER */
        .site-footer { background: var(--primary-dark); color: white; padding: 40px 0; margin-top: 60px; }
        .footer-inner {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 40px;
            font-size: 0.9em;
            text-align: left;
        }
        .footer-col h4 { color: var(--primary-blue); margin-top: 0; text-transform: uppercase; letter-spacing: 1px; }
        .footer-col ul { list-style: none; padding: 0; }
        .footer-col li { margin-bottom: 10px; opacity: 0.8; cursor: pointer; transition: opacity 0.2s; }
        .footer-col li:hover { opacity: 1; color: var(--primary-blue); }

        .brand { font-size: 1.5em; font-weight: 800; color: var(--primary-dark); letter-spacing: -1px; text-transform: uppercase; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .brand span { color: var(--primary-blue); }
        .main-nav { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 5px;}
        .nav-link { padding: 8px 12px; text-decoration: none; color: var(--text-muted); font-weight: 600; font-size: 0.9em; border-radius: 8px; transition: all 0.2s; cursor: pointer; white-space: nowrap; }
        .nav-link:hover { background: #f1f5f9; color: var(--primary-dark); }
        .nav-link.active { background-color: var(--primary-dark); color: white; }

        /* UI ELEMENTS */
        .btn-primary { 
            background: var(--primary-blue); 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            border-radius: 10px; 
            font-weight: 700; 
            cursor: pointer; 
            width: 100%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
            transition: 0.2s; 
            font-family: 'Inter', sans-serif;
            margin-top: 10px;
        }
        .btn-primary:hover { background: #2563eb; }
        
        .btn-secondary { 
            background: #e0f2fe; 
            color: var(--primary-blue); 
            border: none; 
            padding: 12px; 
            border-radius: 8px; 
            font-weight: 600; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 10px; 
            font-family: 'Inter', sans-serif;
            display: flex; 
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-secondary:hover { background: #bae6fd; }

        .btn-outline {
            background: transparent;
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: 0.2s;
        }
        .btn-outline:hover { background: rgba(255,255,255,0.1); border-color: white; }

        .btn-affiliation { 
            background: var(--accent-gold); 
            color: var(--primary-dark); 
            border: none; 
            padding: 15px 30px; 
            border-radius: 10px; 
            font-weight: 700; 
            cursor: pointer; 
            width: 100%; 
            max-width: 100%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
            text-decoration: none;
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            white-space: normal;
            font-family: 'Inter', sans-serif;
            margin-top: 20px; 
            margin-bottom: 5px; 
            box-sizing: border-box;
        }
        .btn-affiliation:hover {
            background: var(--accent-gold-hover);
        }

        /* CALCULATOR */
        .calc-wrapper { display: grid; grid-template-columns: 1fr 380px; gap: 30px; align-items: start; }
        .input-section { background: white; border-radius: 16px; padding: 30px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .sticky-results { 
            position: sticky; 
            top: 100px; 
            background: var(--primary-dark); 
            color: white; 
            border-radius: 16px; 
            padding: 30px; 
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); 
            text-align: center;
            overflow: hidden; 
            box-sizing: border-box; 
        }
        
        @media (max-width: 450px) {
             .sticky-results { padding: 20px; }
             .sticky-results .btn-primary, 
             .sticky-results .btn-secondary, 
             .sticky-results .btn-outline,
             .sticky-results .btn-affiliation {
                 padding: 12px 15px;
                 font-size: 0.95em;
                 margin-top: 10px;
                 width: 100%;
             }
        }
        
        .quick-calc-box {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 20px auto;
            max-width: 800px;
            text-align: left;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .quick-calc-form {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            align-items: end;
        }
        .quick-calc-result {
            background: var(--primary-blue);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            text-align: center;
        }
        .quick-calc-result strong { font-size: 1.4em; display: block; }
        @media (max-width: 600px) { .quick-calc-form { grid-template-columns: 1fr; } }


        .form-group { margin-bottom: 20px; }
        .form-control { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1em; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        .acquisition-result { background: #e0f2fe; color: var(--primary-dark); padding: 25px; border-radius: 12px; text-align: center; margin-top: 30px; }
        .acquisition-result strong { font-size: 3em; font-weight: 800; display: block; line-height: 1.1; color: var(--success); }
        
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; cursor: pointer; margin-top: 10px;}
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; cursor: pointer; background: #cbd5e1; border-radius: 4px; }
        input[type=range]::-webkit-slider-thumb { height: 22px; width: 22px; border-radius: 50%; background: var(--primary-blue); cursor: pointer; -webkit-appearance: none; margin-top: -7px; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input[type=range]::-moz-range-track { width: 100%; height: 8px; cursor: pointer; background: #cbd5e1; border-radius: 4px; }
        input[type=range]::-moz-range-thumb { height: 22px; width: 22px; border-radius: 50%; background: var(--primary-blue); cursor: pointer; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(5px); 
            z-index: 2000; display: none !important; align-items: center; justify-content: center; 
        }
        .modal-overlay.show { display: flex !important; }
        .modal-card { background: white; width: 95%; max-width: 800px; max-height: 90vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column; }
        .modal-header { padding: 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; background: #f8fafc; }
        .modal-body { padding: 20px; overflow-y: auto; }
        .table-responsive { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        .table-responsive th { text-align: left; padding: 12px; background: #f1f5f9; position: sticky; top: 0; }
        .table-responsive td { padding: 12px; border-bottom: 1px solid #e2e8f0; }
        
        .toast {
            visibility: hidden; min-width: 250px; background-color: var(--primary-dark); color: #fff;
            text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 3000;
            left: 50%; bottom: 30px; transform: translateX(-50%); opacity: 0; transition: visibility 0s, opacity 0.5s;
        }
        .toast.show { visibility: visible; opacity: 1; }

        @media (max-width: 768px) {
            .calc-wrapper { grid-template-columns: 1fr; }
            .sticky-results { position: relative; top: 0; margin-top: 20px; }
            .header-inner { flex-direction: column; gap: 15px; }
            .main-nav { width: 100%; justify-content: flex-start; overflow-x: auto; }
            .footer-inner { grid-template-columns: 1fr; text-align: center; }
            #about-page .mission-card { padding: 20px; }
        }
    </style>
</head>
<body>

    <nav class="top-bar">
        <div class="header-inner">
            <div class="brand" onclick="navTo('home', null)">
                <span style="font-size:1.5em;">üèõÔ∏è</span> Horizon <span>Pierre</span>
            </div>
            <div class="main-nav">
                <a class="nav-link active" onclick="navTo('home', this)">Accueil</a>
                <a class="nav-link" onclick="navTo('calculator', this)">Cr√©dit</a>
                <a class="nav-link" onclick="navTo('patrimoine', this)">Rentabilit√©</a>
                <a class="nav-link" onclick="navTo('energie', this)">Audit √ânergie</a>
                <a class="nav-link" onclick="navTo('maintenance', this)">Maintenance</a>
                <a class="nav-link" onclick="navTo('acquisition', this)">Acquisition</a>
                <a class="nav-link" onclick="navTo('lexique', this)">Lexique</a>
                <a class="nav-link" onclick="navTo('about', this)">√Ä Propos</a>
            </div>
        </div>
    </nav>

    <div class="site-wrapper">
        
        <!-- ACCUEIL -->
        <section id="home-page">
            <div style="text-align: center; padding: 60px 20px;">
                <h1 style="font-size: 3em; color: var(--primary-dark); margin-bottom: 10px; line-height: 1.1;">Simulateur de Cr√©dit Immobilier <br>et Outil d'Investissement Gratuit</h1>
                <p style="font-size: 1.2em; color: var(--text-muted); margin-bottom: 40px;">Calculez vos mensualit√©s, estimez la rentabilit√© apr√®s imp√¥ts (LMNP), et s√©curisez votre projet.</p>
                
                <div class="quick-calc-box">
                    <h3>Simulateur de Mensualit√© Express</h3>
                    <div class="quick-calc-form">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>Prix du Bien</label>
                            <input type="number" id="quick_prix" class="form-control" value="200000" oninput="quickCalculate()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>Apport</label>
                            <input type="number" id="quick_apport" class="form-control" value="30000" oninput="quickCalculate()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>Dur√©e (ans)</label>
                            <input type="number" id="quick_duree" class="form-control" value="20" oninput="quickCalculate()">
                        </div>
                        <div class="quick-calc-result">
                            <small style="opacity:0.7;">Mensualit√© estim√©e</small>
                            <strong id="quick_mensualite">0 ‚Ç¨</strong>
                        </div>
                    </div>
                </div>

                <button class="btn-primary" style="width: fit-content; margin: 30px auto 30px auto;" onclick="navTo('calculator', document.querySelectorAll('.nav-link')[1])">D√©marrer l'√©tude compl√®te ‚Üí</button>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
                <div class="glass-panel" onclick="navTo('calculator', document.querySelectorAll('.nav-link')[1])">
                    <span style="font-size: 2em;">üè¶</span>
                    <h3>Simulateur Bancaire</h3>
                    <p style="color:var(--text-muted)">Calcul de mensualit√©, capacit√© d'emprunt et tableau d'amortissement.</p>
                </div>
                <div class="glass-panel" onclick="navTo('patrimoine', document.querySelectorAll('.nav-link')[2])">
                    <span style="font-size: 2em;">üìà</span>
                    <h3>Rentabilit√© & Fiscalit√©</h3>
                    <p style="color:var(--text-muted)">Estimez votre Cashflow Net d'imp√¥ts (LMNP, R√©el).</p>
                </div>
                <div class="glass-panel" onclick="navTo('energie', document.querySelectorAll('.nav-link')[3])">
                    <span style="font-size: 2em;">üå°Ô∏è</span>
                    <h3>Audit √ânergie (DPE)</h3>
                    <p style="color:var(--text-muted)">Estimez la classe √©nerg√©tique en 3 clics.</p>
                </div>
                 <div class="glass-panel" onclick="navTo('maintenance', document.querySelectorAll('.nav-link')[4])">
                    <span style="font-size: 2em;">üõ†Ô∏è</span>
                    <h3>Maintenance & Risques</h3>
                    <p style="color:var(--text-muted)">Estimez la provision annuelle pour les impr√©vus (travaux, vacance).</p>
                </div>
            </div>
        </section>

        <!-- CALCULATEUR CREDIT -->
        <section id="calculator-page" style="display: none;">
            <div class="calc-wrapper">
                <div class="input-section">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <h2 style="margin:0; color:var(--primary-dark);">Simulateur d'Emprunt : Calcul de Mensualit√© & Capacit√©</h2>
                        <div style="background:#f1f5f9; padding:4px; border-radius:8px;">
                            <button id="btn-mens" style="padding:6px 12px; border:none; border-radius:6px; font-weight:600; cursor:pointer;" onclick="setMode('mensualite')">Mensualit√©</button>
                            <button id="btn-cap" style="padding:6px 12px; border:none; border-radius:6px; font-weight:600; cursor:pointer; background:transparent; color:#64748b;" onclick="setMode('capacite')">Capacit√©</button>
                        </div>
                    </div>

                    <form onsubmit="return false;">
                        <div class="form-group"><label>Revenus Nets Foyer <span id="rev_val">4 500 ‚Ç¨</span></label><input type="range" id="revenus" min="1500" max="15000" step="100" value="4500" oninput="updateVal('rev_val', this.value, ' ‚Ç¨'); calculate()"></div>
                        
                        <div id="wrapper-prix"><div class="form-group"><label>Prix du Bien <span id="prix_val">250 000 ‚Ç¨</span></label><input type="number" id="prix_bien" class="form-control" value="250000" oninput="document.getElementById('prix_val').innerText = formatMoney(this.value) + ' ‚Ç¨'; calculate()"></div></div>
                        <div id="wrapper-budget" style="display:none;"><div class="form-group"><label style="color:var(--primary-blue);">Budget Mensuel Max</label><input type="number" id="budget_mensuel" class="form-control" value="1200" oninput="calculate()"></div></div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group"><label>Apport</label><input type="number" id="apport" class="form-control" value="40000" oninput="calculate()"></div>
                            <div class="form-group"><label>Frais Agence</label><input type="number" id="agence" class="form-control" value="10000" oninput="calculate()"></div>
                        </div>
                        
                        <div class="form-group"><label>Dur√©e : <span id="duree_val">20</span> ans</label><input type="range" id="duree" min="7" max="30" value="20" oninput="updateVal('duree_val', this.value, ''); calculate()"></div>
                        <div class="form-group"><label>Taux Cr√©dit : <span id="taux_val" style="color:var(--primary-blue);">3.20 %</span></label><input type="range" id="taux" min="1.0" max="5.5" step="0.05" value="3.20" oninput="document.getElementById('taux_val').innerText = parseFloat(this.value).toFixed(2) + ' %'; calculate()"></div>
                        
                        <!-- NOUVEAU CURSEUR ASSURANCE -->
                        <div class="form-group"><label>Taux Assurance : <span id="ass_val" style="color:var(--text-muted);">0.34 %</span></label><input type="range" id="taux_assurance" min="0.10" max="1.00" step="0.01" value="0.34" oninput="document.getElementById('ass_val').innerText = parseFloat(this.value).toFixed(2) + ' %'; calculate()"></div>
                    </form>
                </div>

                <div class="sticky-results">
                    <div class="donut-chart" id="chart-bg"><div class="donut-hole"><span class="main-metric" id="res_mensualite">0 ‚Ç¨</span><span style="font-size:0.8em; opacity:0.7;">PAR MOIS</span></div></div>
                    <div id="badge_endettement" style="background:rgba(16,185,129,0.2); color:#34d399; display:inline-block; padding:5px 10px; border-radius:20px; font-weight:bold; font-size:0.9em;">33% Endettement</div>
                    <div style="margin-top:20px; text-align:left; border-top:1px solid rgba(255,255,255,0.2); padding-top:15px;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span style="opacity:0.7;">Notaire (~7.5%) + Agence</span><span style="font-weight:700;" id="res_frais_annexes">0 ‚Ç¨</span></div>
                        <div style="display:flex; justify-content:space-between; font-size:1.1em; color:var(--accent-gold); margin-top:10px;"><span>√Ä Financer</span><span style="font-weight:800;" id="res_financer">0 ‚Ç¨</span></div>
                        <div id="res_capacite_box" style="display:none; background:rgba(255,255,255,0.1); padding:10px; border-radius:8px; margin-top:15px; text-align:center;"><small>Budget Achat Max</small><br><strong style="font-size:1.4em; color:var(--success);" id="res_capacite_achat">0 ‚Ç¨</strong></div>
                    </div>
                    
                    <a id="btn_affiliation_courtier" href="#lien-affili√©-courtier" target="_blank" class="btn-affiliation">
                        <span style="font-size: 1.2em;">üí∞</span> Comparez les taux
                    </a>
                    
                    <button class="btn-primary" onclick="openTableModal()"><span>üìä</span> Tableau d'Amortissement</button>
                    <button class="btn-secondary" onclick="shareSimulation()"><span>üîó</span> Copier le lien</button>
                    <button class="btn-outline" onclick="generatePDF()"><span>üì•</span> T√©l√©charger PDF</button>

                    <p style="font-size:0.7em; opacity:0.6; margin-top:15px; margin-bottom:0;">
                        *Simulation √† titre indicatif, non contractuelle. Consultez toujours un professionnel du cr√©dit.
                    </p>
                </div>
            </div>
        </section>

        <!-- RENTABILITE & FISCALITE (Identique v46) -->
        <section id="patrimoine-page" style="display: none;">
             <div class="calc-wrapper">
                <div class="input-section">
                    <h2 style="color:var(--primary-dark);">Rentabilit√© Locative Nette & Fiscalit√© LMNP</h2>
                    <div class="form-group"><label>Prix Achat (FAI)</label><input type="number" id="y_prix" class="form-control" value="200000" oninput="calcYield()"></div>
                    <div class="form-group"><label>Loyer Mensuel (CC)</label><input type="number" id="y_loyer" class="form-control" value="950" oninput="calcYield()"></div>
                    <div class="form-group"><label>Charges Annuelles</label><input type="number" id="y_charges" class="form-control" value="1500" oninput="calcYield()"></div>
                    <div class="form-group"><label>Mensualit√© Cr√©dit</label><input type="number" id="y_credit" class="form-control" value="850" oninput="calcYield()"></div>
                    <div class="form-group"><label>Frais de Gestion <span id="y_gestion_val">8.0</span> %</label><input type="range" id="y_gestion_rate" min="0" max="15" step="0.5" value="8.0" oninput="document.getElementById('y_gestion_val').innerText = parseFloat(this.value).toFixed(1); calcYield()"></div>
                     <div style="background:#f1f5f9; padding:15px; border-radius:8px; margin-top:20px;">
                        <h4 style="margin-top:0; color:var(--primary-dark);">Fiscalit√© (Estimation LMNP)</h4>
                        <div class="form-group"><label>TMI</label><select id="y_tmi" class="form-control" onchange="calcYield()"><option value="0">0 %</option><option value="11">11 %</option><option value="30" selected>30 %</option></select></div>
                        <div class="form-group"><label>R√©gime</label><select id="y_regime" class="form-control" onchange="calcYield()"><option value="micro">Micro-BIC</option><option value="reel">R√©el</option></select></div>
                        <a href="#lien-affili√©-LMNP" class="btn-affiliation">‚öñÔ∏è Audit Fiscalit√© Offert</a>
                    </div>
                </div>
                <div class="sticky-results">
                    <div style="opacity:0.8;">RENTABILIT√â BRUTE</div><div style="font-size:3em; font-weight:800; color:var(--accent-gold); line-height:1;" id="y_brut">5.7%</div>
                    <div style="background:rgba(255,255,255,0.1); padding:15px; border-radius:12px; margin:20px 0;"><div style="font-size:1.5em; font-weight:700;" id="y_cashflow_net">0 ‚Ç¨</div><small>CASHFLOW NET / MOIS</small></div>
                    <div style="display:flex; justify-content:space-between; padding:0 20px;"><div><strong id="y_net">4.9%</strong><br><small>Nette</small></div><div><strong id="y_cashflow_brut">0 ‚Ç¨</strong><br><small>CF Brut</small></div></div>
                </div>
            </div>
        </section>
        
        <!-- AUDIT DPE, MAINTENANCE, ACQUISITION, LEXIQUE, ABOUT, FOOTER... (Conserv√©s Identiques) -->
        <section id="energie-page" style="display:none;"><div class="calc-wrapper"><div class="input-section"><h2>Audit √ânergie</h2><p>Estimez la classe DPE.</p><div class="form-group"><label>Construction</label><select id="dpe_annee" class="form-control" onchange="calcDPE()"><option value="1970">Avant 1974</option><option value="2010" selected>2000-2012</option></select></div><div class="form-group"><label>Chauffage</label><select id="dpe_chauffage" class="form-control" onchange="calcDPE()"><option value="elec">√âlectrique</option><option value="gaz">Gaz</option></select></div></div><div class="sticky-results"><div class="dpe-badge" id="dpe_badge" style="background:var(--dpe-c);">C</div></div></div></section>
        <section id="maintenance-page" style="display:none;"><div class="calc-wrapper"><div class="input-section"><h2>Maintenance</h2><div class="form-group"><label>Loyer Annuel</label><input type="number" id="maint_loyer_annuel" class="form-control" value="11400" oninput="calcMaintenance()"></div><div class="form-group"><label>Vacance %</label><input type="range" id="maint_vacance_rate" value="5" oninput="calcMaintenance()"></div><div class="form-group"><label>Prix Achat</label><input type="number" id="maint_prix_achat" class="form-control" value="200000" oninput="calcMaintenance()"></div><div class="form-group"><label>√âtat</label><select id="maint_etat" class="form-control" onchange="calcMaintenance()"><option value="bon" selected>Bon</option></select></div></div><div class="sticky-results"><div style="font-size:3em; font-weight:800; color:var(--danger);" id="maint_total_annuel">0 ‚Ç¨</div></div></div></section>
        <section id="acquisition-page" style="display:none;"><div class="calc-wrapper"><div class="input-section"><h2>Acquisition</h2><div class="form-group"><label>Apport</label><input type="number" id="acq_apport" class="form-control" value="40000" oninput="calcAcquisition()"></div><div class="form-group"><label>Cashflow Net</label><input type="number" id="acq_cashflow" class="form-control" value="150" oninput="calcAcquisition()"></div></div><div class="sticky-results"><div class="acquisition-result"><strong id="acq_years">0</strong></div></div></div></section>
        <section id="lexique-page" style="display:none;"><h2>Lexique</h2><div class="glass-panel"><p>Cashflow, LMNP...</p></div></section>
        <section id="about-page" style="display:none;"><div class="mission-card"><h2>Mission</h2><p>Outil gratuit.</p></div></section>
    </div>

    <footer class="site-footer"><div class="footer-inner"><div class="footer-col"><h4>Horizon Pierre</h4></div><div class="footer-col"><h4>Outils</h4><ul><li onclick="navTo('calculator')">Simulateur</li></ul></div></div></footer>
    <div id="table-modal" class="modal-overlay"><div class="modal-card"><div class="modal-header"><h3>Tableau</h3><button class="close-modal" onclick="closeTableModal()">√ó</button></div><div class="modal-body"><table class="table-responsive"><tbody id="amortization-body"></tbody></table></div></div></div>
    <div id="toast" class="toast">‚úÖ Lien copi√© !</div>

    <script>
        window.embeddedChatbotConfig = { chatbotId: "gMr_AOgB1wlJ4_LBNeKcQ", domain: "www.chatbase.co" }
    </script>
    <script src="https://www.chatbase.co/embed.min.js" defer></script>

    <script>
        const AFFILIATION_COURTIER_URL = "https://votre-courtier-partenaire.com/comparer-taux?aff=HorizonPierre";
        const AFFILIATION_LMNP_URL = "https://votre-partenaire-comptable.com/audit-lmnp?aff=HorizonPierre";

        document.addEventListener('DOMContentLoaded', () => {
            loadFromURL(); quickCalculate();
        });

        function quickCalculate() {
            const prix = parseFloat(document.getElementById('quick_prix').value) || 0;
            const apport = parseFloat(document.getElementById('quick_apport').value) || 0;
            const duree = parseFloat(document.getElementById('quick_duree').value) || 20;
            const taux = 0.035 / 100; const t_ass = 0.0034; const t_notaire = 0.075; 
            const notaire = prix * t_notaire; const besoin = prix + notaire; const K = Math.max(0, besoin - apport);
            let m_pret = 0; if (K > 0) { const tm = taux/12; const mois = duree*12; m_pret = (K * tm) / (1 - Math.pow(1+tm, -mois)); }
            document.getElementById('quick_mensualite').innerText = formatMoney(m_pret + (K*t_ass/12)) + " ‚Ç¨";
        }

        function navTo(page) {
            document.querySelectorAll('section').forEach(s => s.style.display = 'none');
            const targetId = page === 'dpe' ? 'energie' : page;
            const s = document.getElementById(targetId + '-page'); if(s) s.style.display = 'block';
            window.scrollTo(0,0);
            if(targetId === 'home') quickCalculate(); if(targetId === 'calculator') calculate(); 
            if(targetId === 'patrimoine') calcYield();
        }

        let mode = 'mensualite';
        const formatMoney = (n) => parseFloat(n).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        const updateVal = (id, val, suffix) => document.getElementById(id).innerText = formatMoney(val) + suffix;

        function setMode(m) {
            mode = m;
            document.getElementById('btn-mens').style.background = m==='mensualite' ? '#fff' : 'transparent';
            document.getElementById('btn-cap').style.background = m==='capacite' ? '#fff' : 'transparent';
            if(m === 'capacite') {
                document.getElementById('wrapper-prix').style.display='none'; document.getElementById('wrapper-budget').style.display='block';
                document.getElementById('res_capacite_box').style.display='block'; document.getElementById('res_financer').parentElement.style.display='none';
            } else {
                document.getElementById('wrapper-prix').style.display='block'; document.getElementById('wrapper-budget').style.display='none';
                document.getElementById('res_capacite_box').style.display='none'; document.getElementById('res_financer').parentElement.style.display='flex';
            }
            calculate();
        }

        function calculate() {
            const rev = parseFloat(document.getElementById('revenus').value) || 0;
            const apport = parseFloat(document.getElementById('apport').value) || 0;
            const agence = parseFloat(document.getElementById('agence').value) || 0;
            const duree = parseFloat(document.getElementById('duree').value) || 20;
            const taux = parseFloat(document.getElementById('taux').value) / 100;
            // NOUVEAU : R√©cup√©ration du taux d'assurance
            const taux_assurance_pct = parseFloat(document.getElementById('taux_assurance').value);
            const t_ass = taux_assurance_pct / 100;
            const t_notaire = 0.075; 

            let K = 0, prix = 0, m_pret = 0, m_tot = 0, notaire = 0;

            if(mode === 'mensualite') {
                prix = parseFloat(document.getElementById('prix_bien').value) || 0; notaire = prix * t_notaire;
                let besoin = prix + notaire + agence; K = Math.max(0, besoin - apport);
                let tm = taux/12; let mois = duree*12; if(K>0) m_pret = (K * tm) / (1 - Math.pow(1+tm, -mois));
            } else {
                let budget = parseFloat(document.getElementById('budget_mensuel').value) || 0; m_tot = budget; let mois = duree*12; let tm = taux/12;
                let facteur = (tm / (1 - Math.pow(1+tm, -mois))) + (t_ass/12); K = budget / facteur;
                prix = (K + apport - agence) / (1 + t_notaire); if(prix < 0) prix = 0; notaire = prix * t_notaire;
                m_pret = budget - (K * t_ass / 12); document.getElementById('res_capacite_achat').innerText = formatMoney(prix) + " ‚Ç¨";
            }
            
            let m_ass = (K * t_ass) / 12; 
            if(mode === 'mensualite') m_tot = m_pret + m_ass;
            
            let cout_credit = (m_tot * duree * 12) - K;
            document.getElementById('res_mensualite').innerText = formatMoney(m_tot) + " ‚Ç¨";
            document.getElementById('res_frais_annexes').innerText = formatMoney(notaire + agence) + " ‚Ç¨";
            document.getElementById('res_financer').innerText = formatMoney(K) + " ‚Ç¨";
            
            let endettement = 0; if(rev > 0) endettement = (m_tot / rev) * 100;
            let badge = document.getElementById('badge_endettement'); badge.innerText = endettement.toFixed(1) + "% Endettement";
            if(endettement <= 35) { badge.style.background = "rgba(16,185,129,0.2)"; badge.style.color="#34d399"; }
            else { badge.style.background = "rgba(239,68,68,0.2)"; badge.style.color="#f87171"; }
            
            // Stockage pour le PDF
            window.lastCalc = { K, taux, duree, m_pret, m_tot, m_ass, notaire, cout_credit, prix, agence, apport, mode, taux_assurance: taux_assurance_pct };
        }

        // ... [Les autres fonctions calcYield, calcDPE, calcMaintenance, calcAcquisition, shareSimulation, loadFromURL restent identiques] ...
        function calcYield() { /* Code inchang√© */ }
        function calcDPE() { /* Code inchang√© */ }
        function calcMaintenance() { /* Code inchang√© */ }
        function calcAcquisition() { /* Code inchang√© */ }
        function shareSimulation() { /* Code inchang√© */ }
        function loadFromURL() { /* Code inchang√© */ }

        // --- PDF AJUST√â (V47) ---
        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const data = window.lastCalc;
            if (!data || !data.K) return;

            // En-t√™te
            doc.setFillColor(15, 23, 42); doc.rect(0, 0, 210, 35, 'F');
            doc.setFont("helvetica", "bold"); doc.setFontSize(20); doc.setTextColor(255); doc.text("HORIZON PIERRE", 15, 18);
            doc.setFontSize(10); doc.setFont("helvetica", "normal");
            doc.text(data.mode === 'capacite' ? "Attestation de Capacit√©" : "√âtude de Financement", 15, 26);
            doc.text(`Le ${new Date().toLocaleDateString()}`, 170, 18);

            let y = 50;

            // SECTION 1
            doc.setTextColor(0); doc.setFontSize(14); doc.setFont("helvetica", "bold"); doc.text("1. Co√ªt Total", 15, y); doc.line(15, y+2, 195, y+2); y+=10;
            doc.setFontSize(11); doc.setFont("helvetica", "normal");
            doc.text("Prix Net Vendeur :", 20, y); doc.text(`${formatMoney(data.prix)} ‚Ç¨`, 160, y, {align:'right'}); y+=8;
            doc.text("Frais d'Agence :", 20, y); doc.text(`${formatMoney(data.agence)} ‚Ç¨`, 160, y, {align:'right'}); y+=8;
            doc.text("Frais de Notaire (Estim√©s √† 7.5%) :", 20, y); doc.text(`${formatMoney(data.notaire)} ‚Ç¨`, 160, y, {align:'right'}); y+=10;
            doc.setFont("helvetica", "bold"); doc.text("TOTAL DU PROJET :", 20, y); doc.text(`${formatMoney(parseFloat(data.prix)+parseFloat(data.agence)+parseFloat(data.notaire))} ‚Ç¨`, 160, y, {align:'right'}); y+=20;

            // SECTION 2
            doc.setFontSize(14); doc.text("2. Financement", 15, y); doc.line(15, y+2, 195, y+2); y+=10;
            doc.setFontSize(11); doc.setFont("helvetica", "normal");
            doc.text("Apport Personnel :", 20, y); doc.text(`- ${formatMoney(data.apport)} ‚Ç¨`, 160, y, {align:'right'}); y+=8;
            doc.setFont("helvetica", "bold"); doc.text("EMPRUNT BANCAIRE :", 20, y); doc.text(`${formatMoney(data.K)} ‚Ç¨`, 160, y, {align:'right'}); y+=25;

            // SECTION 3
            doc.setFontSize(14); doc.text("3. D√©tail Emprunt", 15, y); doc.line(15, y+2, 195, y+2); y+=12;
            doc.setFontSize(11); doc.setFont("helvetica", "normal");
            doc.text(`Mensualit√© Cr√©dit (Hors Ass.) :`, 20, y); doc.text(`${formatMoney(data.m_pret)} ‚Ç¨`, 160, y, {align:'right'}); y+=7;
            doc.text(`Assurance (${data.taux_assurance}%) :`, 20, y); doc.text(`${formatMoney(data.m_ass)} ‚Ç¨`, 160, y, {align:'right'}); y+=8;
            doc.setFont("helvetica", "bold"); doc.text(`MENSUALIT√â TOTALE :`, 20, y); doc.text(`${formatMoney(data.m_tot)} ‚Ç¨ / mois`, 160, y, {align:'right'}); y+=12;

            doc.setFont("helvetica", "normal");
            doc.text(`Taux: ${document.getElementById('taux').value}% | Dur√©e: ${data.duree} ans`, 20, y); y+=10;
            let total_ass = data.m_ass * data.duree * 12;
            doc.text(`Co√ªt Int√©r√™ts :`, 20, y); doc.text(`${formatMoney(data.cout_credit - total_ass)} ‚Ç¨`, 160, y, {align:'right'}); y+=7;
            doc.text(`Co√ªt Assurance :`, 20, y); doc.text(`${formatMoney(total_ass)} ‚Ç¨`, 160, y, {align:'right'}); y+=8;
            doc.setFont("helvetica", "bold"); doc.text(`CO√õT TOTAL CR√âDIT :`, 20, y); doc.text(`${formatMoney(data.cout_credit)} ‚Ç¨`, 160, y, {align:'right'}); y+=20;

            // SECTION 4
            doc.setFontSize(14); doc.text("4. Tableau d'Amortissement", 15, y); y+=5;
            let rows = []; let solde = data.K; let tm = data.taux/12;
            for(let an=1; an<= data.duree; an++) {
                let int_an=0, cap_an=0;
                for(let m=0; m<12; m++) { let int=solde*tm; let cap=data.m_pret-int; int_an+=int; cap_an+=cap; solde-=cap; if(solde<0)solde=0; }
                rows.push([`Ann√©e ${an}`, `${formatMoney(solde)} ‚Ç¨`, `${formatMoney(int_an)} ‚Ç¨`, `${formatMoney(cap_an)} ‚Ç¨`]);
            }
            doc.autoTable({ startY: y, head: [['Ann√©e', 'Reste D√ª', 'Int√©r√™ts', 'Capital']], body: rows, theme: 'striped', headStyles: { fillColor: [15, 23, 42] } });
            doc.save("Etude_HorizonPierre.pdf");
        }

        function openTableModal() { document.getElementById('table-modal').classList.add('show'); generateTable(); }
        function closeTableModal() { document.getElementById('table-modal').classList.remove('show'); }
        function generateTable() { /* Code inchang√© */ }
    </script>
</body>
</html>
